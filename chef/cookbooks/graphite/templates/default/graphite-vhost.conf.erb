# Graphite Apache Virtual Host
#
# Generated by Chef
NameVirtualHost *:<%= node['graphite']['listen_port'] %>

# You may need to manually edit this file to fit your needs.
<VirtualHost *:<%= node['graphite']['listen_port']%>>
        ServerName <%= node['graphite']['url'] %>
        <% unless node['graphite']['url_aliases'].empty? %>
        ServerAlias <%= [node['graphite']['url_aliases']].flatten.compact.join(" ") %>
        <% end %>
        DocumentRoot "<%= node['graphite']['doc_root'] %>"
        ErrorLog <%= node['graphite']['storage_dir'] %>/log/webapp/error.log
        CustomLog <%= node['graphite']['storage_dir'] %>/log/webapp/access.log common

        Header set Access-Control-Allow-Origin "*"
        Header set Access-Control-Allow-Methods "GET, OPTIONS"
        Header set Access-Control-Allow-Headers "origin, authorization, accept"

        <Location "/">
                SetHandler python-program
                PythonPath "['<%= node['graphite']['doc_root'] %>'] + sys.path"
                PythonHandler django.core.handlers.modpython
                SetEnv DJANGO_SETTINGS_MODULE graphite.settings
                PythonDebug Off
                PythonAutoReload Off
        </Location>

        <Location "/content/">
                SetHandler None
        </Location>

        <Location "/media/">
                SetHandler None
        </Location>

        <% if node['recipes'].include? "ganglia::web" -%>
	<Location "/ganglia/">
	        SetHandler None
	</Location>
        <% end -%>

	# NOTE: In order for the django admin site media to work you
	# must change @DJANGO_ROOT@ to be the path to your django
	# installation, which is probably something like:
	# /usr/lib/python2.6/site-packages/django
        Alias /media/ "<%= node['graphite']['django_root'] %>/contrib/admin/media/"

</VirtualHost>
